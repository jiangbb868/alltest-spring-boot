!function(m,k){"use strict";var q=ht.AlarmSeverity=function(H,J,O,E,W){this.value=H,this.name=J,this.nickName=O,this.color=E,this.displayName=W};ht.Default.def("ht.AlarmSeverity",k,{toString:function(){return this.displayName||this.name}}),function(){q.severities=new ht.List,q._vm={},q._nm={},q._cp=function(p,G){if(p&&G){var R=p.value-G.value;return R>0?1:0>R?-1:0}return p&&!G?1:!p&&G?-1:0},q.each=function(s,F){q.severities.each(s,F)},q.getSortFunction=function(){return q._cp},q.setSortFunction=function(H){q._cp=H,q.severities.sort(H)},q.add=function(u,A,d,x,m){var c=new q(u,A,d,x,m);return q._vm[u]=c,q._nm[A]=c,q.severities.add(c),q.severities.sort(q._cp),c},q.remove=function(l){var K=q._nm[l];return K&&(delete q._nm[l],delete q._vm[K.value],q.severities.remove(K)),K},q.CRITICAL=q.add(500,"Critical","C","#FF0000"),q.MAJOR=q.add(400,"Major","M","#FFA000"),q.MINOR=q.add(300,"Minor","m","#FFFF00"),q.WARNING=q.add(200,"Warning","W","#00FFFF"),q.INDETERMINATE=q.add(100,"Indeterminate","N","#C800FF"),q.CLEARED=q.add(0,"Cleared","R","#00FF00"),q.isClearedAlarmSeverity=function(K){return K?0===K.value:!1},q.getByName=function(I){return q._nm[I]},q.getByValue=function(V){return q._vm[V]},q.clear=function(){q.severities.clear(),q._vm={},q._nm={}},q.compare=function($,Q){return q._cp($,Q)}}();var e=ht.AlarmState=function(J){this._d=J,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",k,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var e=null;for(var a in this._am)a=q.getByName(a),q.isClearedAlarmSeverity(a)||0!==this.getAcknowledgedAlarmCount(a)&&(e=e?q.compare(e,a)>0?e:a:a);this._haa=e},_c2:function(){var I=null;for(var u in this._nm)u=q.getByName(u),q.isClearedAlarmSeverity(u)||0!==this.getNewAlarmCount(u)&&(I=I?q.compare(I,u)>0?I:u:u);this._hna=I},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var P in this._nm)if(P=q.getByName(P),!q.isClearedAlarmSeverity(P)&&0!==this.getNewAlarmCount(P)&&q.compare(this._hna,P)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var p=this._haa,T=this._hna,C=this._ps;this._hoa=p,q.compare(T,this._hoa)>0&&(this._hoa=T),q.compare(C,this._hoa)>0&&(this._hoa=C)},_c5:function(){var X=this._haa,N=this._hna;this._hta=X,q.compare(N,this._hta)>0&&(this._hta=N)},increaseAcknowledgedAlarm:function(X,m){if(0!==m){m=m||1;var P=this._am[X.name]||0;P+=m,this._am[X.name]=P,this._f()}},increaseNewAlarm:function(F,U){if(0!==U){U=U||1;var P=this._nm[F.name]||0;P+=U,this._nm[F.name]=P,this._f()}},decreaseAcknowledgedAlarm:function(t,R){if(0!==R){R||(R=1);var X=this._am[t.name]||0;if(X-=R,0>X)throw"Alarm count can not be negative";this._am[t.name]=X,this._f()}},decreaseNewAlarm:function(N,u){if(0!==u){u||(u=1);var G=this._nm[N.name]||0;if(G-=u,0>G)throw"Alarm count can not be negative";this._nm[N.name]=G,this._f()}},acknowledgeAlarm:function(J){this.decreaseNewAlarm(J,1),this.increaseAcknowledgedAlarm(J,1)},acknowledgeAllAlarms:function(Y){if(Y){var v=this.getNewAlarmCount(Y);this.decreaseNewAlarm(Y,v),this.increaseAcknowledgedAlarm(Y,v)}else for(var u in this._nm)this.acknowledgeAllAlarms(q.getByName(u))},_c6:function(){this._aac=0;for(var H in this._am)H=q.getByName(H),this._aac+=this.getAcknowledgedAlarmCount(H)},getAcknowledgedAlarmCount:function(i){return i?this._am[i.name]||0:this._aac},getAlarmCount:function(H){return this.getAcknowledgedAlarmCount(H)+this.getNewAlarmCount(H)},_c7:function(){this._nac=0;for(var m in this._nm)this._nac+=this.getNewAlarmCount(q.getByName(m))},getNewAlarmCount:function(Y){return Y?this._nm[Y.name]||0:this._nac},setNewAlarmCount:function(e,d){this._nm[e.name]=d,this._f()},removeAllNewAlarms:function(g){g?delete this._nm[g]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(x,N){this._am[x.name]=N,this._f()},removeAllAcknowledgedAlarms:function(u){u?delete this._am[u.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(l){if(this._ep||(l=null),this._ps!==l){var Z=this._ps;this._ps=l,this._f(),this._d.fp("propagateSeverity",Z,l)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(F){var g=this._ep;this._ep=F,this._d.fp("enablePropagation",g,F)&&(F||this.setPropagateSeverity(null))}});var B=ht.AlarmStatePropagator=function(U){this._dataModel=U,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",k,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(f){this._enable!==f&&(this._enable=f,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(C){this.propagate(C)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(l){if("alarmState"===l.property||"enablePropagation"===l.property)this.propagate(l.data);else if("parent"===l.property){var d=l.oldValue;d&&this.propagate(d),this.propagate(l.data)}},propagate:function(e){e&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(e),this._isPropagating=!1)},propagateToTop:function(y){for(this.propagateToParent(null,y);y&&y.getParent();)this.propagateToParent(y,y.getParent()),y=y.getParent()},propagateToParent:function(H,J){var e=null;J.getChildren().each(function(x){var c=x.getAlarmState().getHighestOverallAlarmSeverity();q.compare(c,e)>0&&(e=c)}),J.getAlarmState().setPropagateSeverity(e)}}),ht.AlarmStateStatistics=function(b){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(b)},ht.Default.def("ht.AlarmStateStatistics",k,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(k){var i=this._dataModel;i!==k&&(i&&(i.umd(this.handleDataPropertyChange,this),i.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=k,this.reset(),k.md(this.handleDataPropertyChange,this),k.mm(this.handleDataModelChange,this),this.fp("dataModel",i,k))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(O){"alarmState"===O.property&&(this.increase(O.data),this.fireAlarmStateChange())},handleDataModelChange:function(h){"add"===h.kind?(this.increase(h.data),this.fireAlarmStateChange()):"remove"===h.kind?(this.decrease(h.data),this.fireAlarmStateChange()):"clear"===h.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,q.each(function(f){var V=this.getSumInfo(f);this.sumAcked+=V.ackedCount,this.sumNew+=V.newCount,this.sumTotal+=V.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(M){if(!M)return this.sumNew;var e=this.getSumInfo(M);return e.newCount},getAcknowledgedAlarmCount:function(L){if(!L)return this.sumAcked;var E=this.getSumInfo(L);return E.ackedCount},getTotalAlarmCount:function(W){if(!W)return this.sumTotal;var s=this.getSumInfo(W);return s.totalCount},getSumInfo:function(t){var B=this.severtiyMap[t.name];return B||(B={},B.newCount=0,B.ackedCount=0,B.totalCount=0,this.severtiyMap[t.name]=B),B},decrease:function(S){var P=this.dataMap[S.getId()];P&&(delete this.dataMap[S.getId()],q.each(function(M){var h=P[M.name],T=this.getSumInfo(M);T.newCount=T.newCount-h.newCount,T.ackedCount=T.ackedCount-h.ackedCount,T.totalCount=T.totalCount-h.totalCount},this))},increase:function(Z){if(this.decrease(Z),!this._filterFunc||this._filterFunc(Z)){var d={},T=Z.getAlarmState();this.dataMap[Z.getId()]=d,q.each(function(H){var B={};B.newCount=T.getNewAlarmCount(H),B.ackedCount=T.getAcknowledgedAlarmCount(H),B.totalCount=T.getAlarmCount(H),d[H.name]=B;var Q=this.getSumInfo(H);Q.newCount=Q.newCount+B.newCount,Q.ackedCount=Q.ackedCount+B.ackedCount,Q.totalCount=Q.totalCount+B.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(R){var Z=this._filterFunc;this._filterFunc=R,this.reset(),this.firePropertyChange("filterFunc",Z,R)},getFilterFunc:function(){return this._filterFunc}});var w=ht.Data.prototype;w.getAlarmState=function(){return this._alarmState||(this._alarmState=new e(this))},w=ht.DataModel.prototype,w.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},w.setEnableAlarmStatePropagator=function(J){J!=this.isEnableAlarmStatePropagator()&&(J?(this._alarmStatePropagator=new B(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},w=ht.graph.GraphView.prototype,w.getNote2=function(t){var E=t.getAlarmState().getHighestNewAlarmSeverity();if(E){var e=t.getAlarmState().getNewAlarmCount(E)+E.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(e+="+"),e}return t.s("note2")},w.getNote2Background=function($){var i=$.getAlarmState().getHighestNewAlarmSeverity();return i?i.color:$.s("note2.background")},w.getBodyColor=function(E){var R=E.getAlarmState().getHighestNativeAlarmSeverity();return R?R.color:E.s("body.color")},w.getBorderColor=function(X){var i=X.getAlarmState().getPropagateSeverity();return i?i.color:X.s("border.color")},w=ht.widget.TreeView.prototype,w.getBorderColor=function(z){var n=z.getAlarmState().getPropagateSeverity();return n?n.color:z.s("border.color")},w.getIcon=function(K){return K.getIcon()?"__alarmIcon__":null},w=ht.widget.TreeTableView.prototype,w.getBorderColor=function(I){var p=I.getAlarmState().getPropagateSeverity();return p?p.color:I.s("border.color")},w.getIcon=function(K){return K.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(o){return o.getIcon()}},color:{func:function($){var F=$.getAlarmState().getHighestNativeAlarmSeverity();return F?F.color:$.s("body.color")}},rect:[0,0,16,16]}]});var u=ht.Style;u["note2.expanded"]=!0,u["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);