!function(X,b){"use strict";var q="ht",e=q+".layout.",N=X[q]||module.parent.exports.ht,T=N.List,f=N.DataModel,K=N.Node,I=N.Edge,V=N.Group,s=Math,R=s.sqrt,P=s.random,d=s.max,x=s.min,n=function(j){return j*j};N.Default.getInternal().addMSMap({ms_force:function(e){e._interval=50,e._stepCount=10,e._motionLimit=.01,e._edgeRepulsion=.65,e._nodeRepulsion=.65,e._damper=1,e._maxMotion=0,e._motionRatio=0,e.init=function(E){var v=this;E instanceof f?v.dm=E:v.gv=E,v._nodeMap={},v._nodes=new T,v._edges=new T},e.start=function(){var Z=this,j=Z.gv;if(!Z._timer){var y=Z.cdm=j?j.dm():Z.dm;y.mm(Z.handleDataModelChange,Z),y.md(Z.handleDataPropertyChange,Z),j&&j.mp(Z.handleGV,Z),y.each(function(m){if(Z.isVisible(m)&&Z.isLayoutable(m)&&m instanceof K)if(Z instanceof J){var F=m.p3();m.p3([F[0]+P(),F[1]+P(),F[2]+P()])}else F=m.p(),m.p(F.x+P(),F.y+P())}),Z._timer=setInterval(function(){Z.relax()},Z._interval),Z._damper=1}},e.stop=function(){var p=this;p._timer&&(p.cdm.umm(p.handleDataModelChange,p),p.cdm.umd(p.handleDataPropertyChange,p),p.gv&&p.gv.ump(p.handleGV,p),clearInterval(p._timer),delete p._timer,delete p.cdm)},e.handleGV=function(f){var Y=this;if("dataModel"===f.property){var i=f.oldValue,y=f.newValue;i&&(i.umm(Y.handleDataModelChange,Y),i.umd(Y.handleDataPropertyChange,Y)),this.cdm=y,y.mm(Y.handleDataModelChange,Y),y.md(Y.handleDataPropertyChange,Y)}},e.relax=function(){var v=this;if(!(v._damper<.1&&v._maxMotion<v._motionLimit)){this.cdm.each(function(R){v.isVisible(R)&&(R instanceof I?v.addEdge(R):R instanceof K&&v.addNode(R))});for(var H,A,P=0,q=v._edges,U=v._nodes,p=U.size();P<v._stepCount;P++){for(q.each(v.relaxEdge,v),H=0;p>H;H++)for(A=0;p>A;A++)v.relaxNode(U.get(H),U.get(A));v.moveNode()}v._isAdjusting=1,U.each(function(f){f.fix||(f.p?f.v.p3(f.p):f.v.p(f.x,f.y))}),delete v._isAdjusting,v._nodeMap={},U.clear(),q.clear(),v.onRelaxed()}},e.onRelaxed=function(){},e.isRunning=function(){return!!this._timer},e.isVisible=function($){return $.s("layoutable")===!1?!1:this.gv?this.gv.isVisible($):!0},e.isLayoutable=function($){if($.s("layoutable")===!1)return!1;if($ instanceof V)return!1;var J=this;return J.gv?J.gv.isMovable($)&&!J.gv.isSelected($):!(J.cdm||J.dm).sm().co($)},e.getNodeRepulsion=function(){return this._nodeRepulsion},e.setNodeRepulsion=function(w){this._nodeRepulsion=w,this._damper=1},e.getEdgeRepulsion=function(){return this._edgeRepulsion},e.setEdgeRepulsion=function(F){this._edgeRepulsion=F,this._damper=1},e.getStepCount=function(){return this._stepCount},e.setStepCount=function(L){this._stepCount=L,this._damper=1},e.getInterval=function(){return this._interval},e.setInterval=function(H){var R=this;R._interval!==H&&(R._interval=H,R._timer&&(clearInterval(R._timer),R._timer=setInterval(function(){R.relax()},H)))},e.handleDataPropertyChange=function(P){!this._isAdjusting&&this.isVisible(P.data)&&(this._damper=1)},e.handleDataModelChange=function(){this._damper=1},e.damp=function(){var J=this._maxMotion,W=this._damper;this._motionRatio<=.001&&((.2>J||J>1&&.9>W)&&W>.01?this._damper-=.01:.4>J&&W>.003?this._damper-=.003:W>1e-4&&(this._damper-=1e-4)),J<this._motionLimit&&(this._damper=0)}}}),N.layout.ForceLayout=function(k){this.init(k)},N.Default.def(e+"ForceLayout",b,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(Z){this._limitBounds=Z,this._damper=1},getNodeSize:function(_){var U=this.gv;return U&&U.getDataUIBounds?U.getDataUIBounds(_):_.getRect()},addNode:function(T){var p=this,w=p._nodeMap[T._id];if(w)return w;var J=T.p();w={v:T,x:J.x,y:J.y,dx:0,dy:0,fix:!p.isLayoutable(T),s:p.getNodeSize(T)};var N=w.s,t=R(n(N.width)+n(N.height))*p._nodeRepulsion;return w.r=1>t?100:t,p._nodeMap[T._id]=w,p._nodes.add(w),w},addEdge:function(Z){if(Z._40I&&Z._41I){var S=this,T=S.addNode(Z._40I),b=S.addNode(Z._41I),L={s:T,t:b};b=b.s,T=T.s;var v=b.width+T.width,Q=b.height+T.height;L.length=R(v*v+Q*Q)*S._edgeRepulsion,L.length<=0&&(L.length=100),S._edges.add(L)}},relaxEdge:function(o){var C=o.t,k=o.s,P=C.x-k.x,W=C.y-k.y,L=R(P*P+W*W),n=100*o.length,c=.25*P/n*L,F=.25*W/n*L;C.dx=C.dx-c,C.dy=C.dy-F,k.dx=k.dx+c,k.dy=k.dy+F},relaxNode:function(w,m){if(w!==m){var V=0,Q=0,h=w.x-m.x,d=w.y-m.y,T=h*h+d*d;0===T?(V=P(),Q=P()):36e4>T&&(V=h/T,Q=d/T);var s=w.r*m.r/400;V*=s,Q*=s,w.dx+=V,w.dy+=Q,m.dx-=V,m.dy-=Q}},moveNode:function(){var r=this,h=r._limitBounds,w=r._maxMotion,U=0,v=r._damper;r._nodes.each(function(C){if(!C.fix){var t=C.dx*v,B=C.dy*v;if(C.dx=t/2,C.dy=B/2,U=d(R(t*t+B*B),U),C.x+=d(-40,x(40,t)),C.y+=d(-40,x(40,B)),h){C.x<h.x&&(C.x=h.x,r.adjust(1,0)),C.y<h.y&&(C.y=h.y,r.adjust(0,1));var T=C.s;C.x+T.width>h.x+h.width&&(C.x=h.x+h.width-T.width,r.adjust(-1,0)),C.y+T.height>h.y+h.height&&(C.y=h.y+h.height-T.height,r.adjust(0,-1))}}}),r._maxMotion=U,r._motionRatio=U>0?w/U-1:0,r.damp()},adjust:function(J,t){var A=this._limitBounds;this._nodes.each(function(u){J>0?(!A||u.x+u.s.width+J<A.x+A.width)&&(u.x+=J):(!A||u.x+J>A.x)&&(u.x+=J),t>0?(!A||u.y+u.s.height+t<A.y+A.height)&&(u.y+=t):(!A||u.y+t>A.y)&&(u.y+=t)})}});var J=N.layout.Force3dLayout=function(o){this.init(o)};N.Default.def(e+"Force3dLayout",b,{ms_force:1,getNodeSize3d:function(j){return j.s3()},addNode:function(Y){var a=this,B=a._nodeMap[Y._id];if(B)return B;B={v:Y,p:Y.p3(),d:[0,0,0],fix:!a.isLayoutable(Y),s:a.getNodeSize3d(Y)};var F=B.s,e=N.Default.getDistance(F)*a._nodeRepulsion;return B.r=1>e?100:e,a._nodeMap[Y._id]=B,a._nodes.add(B),B},addEdge:function(u){if(u._40I&&u._41I){var L=this,w=L.addNode(u._40I),A=L.addNode(u._41I),o={s:w,t:A};A=A.s,w=w.s,o.length=R(n(A[0]+w[0])+n(A[1]+w[1])+n(A[2]+w[2]))*L._edgeRepulsion,o.length<=0&&(o.length=100),L._edges.add(o)}},relaxEdge:function(Z){var z=Z.t.p,D=Z.s.p,h=Z.t.d,F=Z.s.d,V=z[0]-D[0],H=z[1]-D[1],W=z[2]-D[2],a=R(V*V+H*H+W*W),S=100*Z.length,C=.25*V/S*a,s=.25*H/S*a,Y=.25*W/S*a;h[0]-=C,h[1]-=s,h[2]-=Y,F[0]+=C,F[1]+=s,F[2]+=Y},relaxNode:function(b,S){if(b!==S){var R=b.p,F=S.p,z=0,J=0,Q=0,C=R[0]-F[0],E=R[1]-F[1],o=R[2]-F[2],H=C*C+E*E+o*o;0===H?(z=P(),J=P(),Q=P()):216e6>H&&(z=C/H,J=E/H,Q=o/H);var Y=b.r*S.r/400,q=b.d,W=S.d;z*=Y,J*=Y,Q*=Y,q[0]+=z,q[1]+=J,q[2]+=Q,W[0]-=z,W[1]-=J,W[2]-=Q}},moveNode:function(){var _=this,t=_._maxMotion,K=0,p=_._damper;_._nodes.each(function(W){if(!W.fix){var b=W.p,Q=W.d,F=Q[0]*p,y=Q[1]*p,q=Q[2]*p;Q[0]=F/2,Q[1]=y/2,Q[2]=q/2,K=d(R(F*F+y*y+q*q),K),b[0]+=d(-40,x(40,F)),b[1]+=d(-40,x(40,y)),b[2]+=d(-40,x(40,q))}}),_._maxMotion=K,_._motionRatio=K>0?t/K-1:0,_.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);