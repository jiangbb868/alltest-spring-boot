!function(K,Y){"use strict";var c="ht",X=K[c],m=X.Default,g=m.def,w="add",j="remove",Z=m.getInternal(),P="propertyChange";X.HistoryManager=function(J){this._histories=[],this.setDataModel(J)},g(X.HistoryManager,Y,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var m=this;m.$4p++,1===m.$4p&&(m.$3p=[])},endInteraction:function(){var b=this,v=b._histories,p=b._historyIndex,L=b.$3p;b.$4p>0&&b.$4p--,0===b.$4p&&(delete b.$3p,L&&L.length&&(v=v.slice(0,p+1),v.push(L),v.length>b._maxHistoryCount&&(v=v.slice(v.length-b._maxHistoryCount)),b.setHistories(v),b.setHistoryIndex(v.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(_){var W=this,L=W._dataModel;L!==_&&(L&&(delete L._historyManager,L.umm(W.$5p,W),L.umd(W.$6p,W)),W._dataModel=_,_._historyManager=W,_.mm(W.$5p,W),_.md(W.$6p,W),W.fp("dataModel",L,_),W.clear())},setHistoryIndex:function(B,J){var f=this,Q=f._historyIndex,w=f._histories.length;if(-1>B?B=-1:B>=w&&(B=w-1),Q!==B){if(!J){var N=B-Q;N>0?f.$2p(N):0>N&&f.$1p(-N)}f._historyIndex=B,f.fp("historyIndex",Q,B)}},setMaxHistoryCount:function(M){var p=this,y=p._histories,U=p._maxHistoryCount;(!M||0>=M)&&(M=10),U!==M&&(p._maxHistoryCount=M,p.fp("maxHistoryCount",U,M),y.length>M&&p.clear())},isPropertyRecode:function(){return!0},$5p:function(f){if(!this.$7p&&!this.$8p){var x,B,K=this,S=K._histories,l=f.kind,y=f.property,p=K._historyIndex;if(l===w||l===j?B={type:f.kind,data:f.data}:K.isPropertyRecode(y)&&y&&"children"!==y&&"attaches"!==y&&"shape"!==y&&"*"!==y&&(B={type:P,data:f.data,property:y,oldValue:f.oldValue,newValue:f.newValue}),B)if(K.$4p){x=K.$3p;var d=!1;if(B.type===P)for(var v=x.length-1;v>=0;v--){var s=x[v];if(s.type!==P)break;B.property===s.property&&s.property&&B.data===s.data&&(B.oldValue=s.oldValue,x[v]=B,d=!0)}d||x.push(B)}else x=[B],S=S.slice(0,p+1),S.push(x),S.length>K._maxHistoryCount&&(S=S.slice(S.length-K._maxHistoryCount)),K.setHistories(S),K.setHistoryIndex(S.length-1,!0)}},$6p:function(M){this.$5p(M)},undo:function(P){(!P||0>=P)&&(P=1),this.setHistoryIndex(this._historyIndex-P)},$1p:function(I){var b,G=this,h=G._dataModel,p=G._histories,d=G._historyIndex;for(G.$7p=1,m.setIsolating(!0);I>0;){if(d>=0&&d<p.length){b=p[d],d--;for(var l=b.length-1;l>=0;l--){var B=b[l],s=B.type,X=B.data,K=B.property,P=B.oldValue;if(s===w)h.remove(X);else if(s===j)h.add(X);else{var H=null;0===K.indexOf("a:")?(H="attr",K=K.replace("a:","")):0===K.indexOf("s:")&&(H="style",K=K.replace("s:","")),Z.setPropertyValue(X,H,K,P)}}}I--}m.setIsolating(!1),delete G.$7p},redo:function(t){(!t||0>=t)&&(t=1),this.setHistoryIndex(this._historyIndex+t)},$2p:function(l){var h,D=this,c=D._dataModel,H=D._histories,B=D._historyIndex;for(D.$7p=1,m.setIsolating(!0);l>0;){if(B>=-1&&B<H.length-1){B++,h=H[B];for(var X=0;X<h.length;X++){var W=h[X],Y=W.type,g=W.data,x=W.property,q=W.newValue;if(Y===w)c.add(g);else if(Y===j)c.remove(g);else{var p=null;0===x.indexOf("a:")?(p="attr",x=x.replace("a:","")):0===x.indexOf("s:")&&(p="style",x=x.replace("s:","")),Z.setPropertyValue(g,p,x,q)}}}l--}m.setIsolating(!1),delete D.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);