!function(B){"use strict";var R="ht",J=B[R],g=J.Default,K=Math,j=K.PI,L=2*j,G=K.sin,f=K.cos,Y=K.atan2,X=K.sqrt,e=K.max,i=K.floor,F=(K.round,K.ceil),q=K.abs,D=J.Shape,o=J.Edge,b=J.List,C=J.Style,H=J.graph,c=g.getInternal(),y=c.ui(),z=null,U="__segmentLengths",T="__lineTotalLength",W="__linePoints",w="__distance0",n="flow.count",M="flow.step",Z="flow.element.max",V="flow.element.count",s="flow.element.min",x="flow.element.space",N="flow.element.autorotate",v="flow.element.background",l="flow.element.shadow.max",E="flow.element.shadow.min",u="flow.element.shadow.begincolor",k="flow.element.shadow.endcolor",r="flow.element.shadow.visible",I="flow.element.image",p="flow",t="prototype",_=H.GraphView[t],Q=J.Data[t],h=y.DataUI[t],S=y.ShapeUI[t],$=y.EdgeUI[t],A=J.DataModel[t],m=S._80o,O=$._80o,d=A.prepareRemove,a=$._79o,P=S._79o,nl=_.setDataModel,Nj=function(z){return document.createElement(z)};_.calculatePointLength=function(R,I,h){var J=this,A=J.getDataUI(R);h==z&&(h=.1);var K=km(A),x=[];if(K){for(var O=K.length,G=0;O>G;G++){var Y=K[G];Y._as&&(Y=Y._as);for(var s=Y[0],H=1;H<Y.length;H++)x.push([s,Y[H]]),s=Y[H]}for(var D=[],G=0;G<x.length;G++){var N=Ag(x[G][0],x[G][1],I);D.push(N)}var a=D.slice(0);a.sort(function(G,m){return G.z>m.z?1:G.z<m.z?-1:0});var B=a[0];if(B.z<h){for(var i=D.indexOf(B),Q=0,G=0;i>=G;G++)Q+=i>G?g.getDistance(x[G][0],x[G][1]):g.getDistance(x[G][0],B);return Q}}},g.calculatePointLength=function(c,Y,J,D){D==z&&(D=.1);var v=km(z,c,Y),Y=[];if(v){for(var l=v.length,_=0;l>_;_++){var M=v[_];M._as&&(M=M._as);for(var N=M[0],d=1;d<M.length;d++)Y.push([N,M[d]]),N=M[d]}for(var u=[],_=0;_<Y.length;_++){var V=Ag(Y[_][0],Y[_][1],J);u.push(V)}var t=u.slice(0);t.sort(function(K,L){return K.z>L.z?1:K.z<L.z?-1:0});var y=t[0];if(y.z<D){for(var o=u.indexOf(y),k=0,_=0;o>=_;_++)k+=o>_?g.getDistance(Y[_][0],Y[_][1]):g.getDistance(Y[_][0],y);return k}}},_.calculateClosestPoint=function(k,q){var A=this,U=A.getDataUI(k),Y=km(U),D=[];if(Y){for(var E=Y.length,N=0;E>N;N++){var a=Y[N];a._as&&(a=a._as);for(var J=a[0],y=1;y<a.length;y++)D.push([J,a[y]]),J=a[y]}for(var $=[],N=0;N<D.length;N++){var X=Ag(D[N][0],D[N][1],q);$.push(X)}return $.sort(function(b,B){return b.z>B.z?1:b.z<B.z?-1:0}),$[0]}},g.calculateClosestPoint=function(r,U,J){var R=km(z,r,U),U=[];if(R){for(var B=R.length,F=0;B>F;F++){var f=R[F];f._as&&(f=f._as);for(var y=f[0],Z=1;Z<f.length;Z++)U.push([y,f[Z]]),y=f[Z]}for(var q=[],F=0;F<U.length;F++){var w=Ag(U[F][0],U[F][1],J);q.push(w)}return q.sort(function(X,M){return X.z>M.z?1:X.z<M.z?-1:0}),q[0]}},_.getPercentAngle=function(C,h){var i=this,G=i.getDataUI(C),w=C.getRotation?C.getRotation():0,j=km(G);if(j)if(0===h){var U=j[0][0],L=j[0][1];w+=Y(L.y-U.y,L.x-U.x)}else if(100===h){j=j[j.length-1];var U=j[j.length-2],L=j[j.length-1];w+=Y(L.y-U.y,L.x-U.x)}else{for(var W=0,l=[],Q=j.length,R=0;Q>R;R++){var u=j[R],g=Tm(u);W+=g,l.push(g)}for(var E=W*h/100,S=bq(E,l),Z=0,y=0;S>y;y++)Z+=l[y];E-=Z;for(var V=gl(j[S],E),e=j[S],I=0,H=0,b=0;b<e.length-1;b++){var D=e[b],p=e[b+1],O=p.x-D.x,T=p.y-D.y,d=X(O*O+T*T);if(I+=d,I>E){H=b;break}}var c=e[H];w+=Y(V.y-c.y,V.x-c.x)}return w},g.getPercentAngle=function(y,w,o){var F=0,M=km(z,y,w);if(M)if(0===o){var U=M[0][0],O=M[0][1];F+=Y(O.y-U.y,O.x-U.x)}else if(100===o){M=M[M.length-1];var U=M[M.length-2],O=M[M.length-1];F+=Y(O.y-U.y,O.x-U.x)}else{for(var T=0,I=[],d=M.length,f=0;d>f;f++){var W=M[f],E=Tm(W);T+=E,I.push(E)}for(var Q=T*o/100,L=bq(Q,I),s=0,R=0;L>R;R++)s+=I[R];Q-=s;for(var P=gl(M[L],Q),N=M[L],i=0,A=0,k=0;k<N.length-1;k++){var D=N[k],t=N[k+1],u=t.x-D.x,b=t.y-D.y,V=X(u*u+b*b);if(i+=V,i>Q){A=k;break}}var c=N[A];F+=Y(P.y-c.y,P.x-c.x)}return F},_.calculateLength=function($){var G=this,p=G.getDataUI($),t=km(p),y=0;if(t)if(Array.isArray(t[0]))for(var S=t.length,v=0;S>v;v++){var b=t[v],V=Tm(b);y+=V}else y=Tm(t);return y},g.calculateLength=function(y,P){var y=km(z,y,P),g=0;if(y)if(Array.isArray(y[0]))for(var G=y.length,b=0;G>b;b++){var X=y[b],Y=Tm(X);g+=Y}else g=Tm(y);return g};var Ag=g.calculateClosestPointOnLine=function(E,G,u){var x=E.x,F=E.y,z=G.x,H=G.y,K=u.x,y=u.y,C={},b=z-x,r=H-F,_=Math.sqrt(b*b+r*r),J=b/_,q=r/_,V=(-x+K)*J+(-F+y)*q;return C.x=x+V*J,C.y=F+V*q,ms(C,E,G)||(C.x=Math.abs(C.x-E.x)<Math.abs(C.x-G.x)?E.x:G.x,C.y=Math.abs(C.y-E.y)<Math.abs(C.y-G.y)?E.y:G.y),b=K-C.x,r=y-C.y,C.z=Math.sqrt(b*b+r*r),C},ms=function(h,u,k){return h.x>=Math.min(u.x,k.x)&&h.x<=Math.max(u.x,k.x)&&h.y>=Math.min(u.y,k.y)&&h.y<=Math.max(u.y,k.y)},Tm=function(n){for(var q=0,a=n.length-1,z=0;a>z;z++){var y=n[z],Y=n[z+1],t=Y.x-y.x,A=Y.y-y.y,I=X(t*t+A*A);q+=I}return q},gl=function(a,Q){for(var N=0,t=0,O=0,s=a.length-1,V=0;s>V;V++){var c=a[V],K=a[V+1],_=K.x-c.x,I=K.y-c.y;if(O=X(_*_+I*I),N+=O,N>Q){N-=O,t=V;break}}var L=a[t],l=a[t+1],P=Y(l.y-L.y,l.x-L.x),A=Q-N,I=G(P)*A,_=f(P)*A;return{x:L.x+_,y:L.y+I}},Fk=function(W,y,X,x){var I=f(x),n=G(x),K=I*y-n*X,u=n*y+I*X;return W?{x:W.x+K,y:W.y+u}:{x:K,y:u}},Vb=function(f,l){f[U]=f[T]=f[W]=l[w]=z},Zd=function(w,W,y,P,Y,E){var x,R,n,I,v,k,Q,B,M,_,z,U=[];if(q(P)>L&&(P=L),v=F(q(P)/(j/4)),x=P/v,R=-x,n=-y,v>0){k=w+f(y)*Y,Q=W+G(-y)*E,U.push({x:k,y:Q});for(var V=0;v>V;V++)n+=R,I=n-R/2,B=w+f(n)*Y,M=W+G(n)*E,_=w+f(I)*(Y/f(R/2)),z=W+G(I)*(E/f(R/2)),U.push({x:_,y:z}),U.push({x:B,y:M})}return U},km=function(C,N,j){if(N==z){var B=C._data;if(B instanceof D){if(N=B.getPoints(),j=B.getSegments(),(!j||0===j.size())&&N){j=new J.List([1]);for(var Z=1;Z<N.size();Z++)j.add(2)}}else if(B instanceof o){var q=C._78o;if(q){var K=q.type,v=q.points,H=q.segments,a=q._4O;if(!K||v){var A=q._69o,W=A.x,$=A.y,P=q._70o,M=P.x,r=P.y;if(K)H?(N=new b({x:W,y:$}),N.addAll(v),N.add({x:M,y:r}),j=new b(H._as)):(N=new b({x:W,y:$}),j=new b([1]),v.each(function(d){N.add(d),j.add(2)}),N.add({x:M,y:r}),j.add(2));else if(q.looped){N=new b(Zd(W,$,0,L,q.radius,q.radius)),j=new b([1]);for(var Z=0;Z<(N.size()-1)/2;Z++)j.add(3)}else N=new b,q.center?(N.add({x:q.c1.x,y:q.c1.y}),N.add({x:W,y:$}),N.add({x:M,y:r}),N.add({x:q.c2.x,y:q.c2.y}),j=new b([1,2,2,2])):(N.add({x:W,y:$}),N.add({x:M,y:r}),j=new b([1,2]))}else if(a)if(N=new b(a.points._as),a.segments)j=new b(a.segments._as);else{j=new b([1]);for(var Z=1;Z<a.points.size();Z++)j.add(2)}}}}if(N){if(Array.isArray(N)&&(N=new b(N)),"number"==typeof N.get(0)){for(var u=new J.List,Z=0;Z<N.size();Z+=2)u.add({x:N.get(Z),y:N.get(Z+1)});N=u}if(!j){j=[];for(var Z=0;Z<N.size();Z++)0===Z?j.push(1):j.push(2)}Array.isArray(j)&&(j=new b(j));for(var T=c.toPointsArray(N._as,j._as,50),e=T.length,n=[],Z=0;e>Z;Z++){var Y=T[Z];Y.length>1&&n.push(Y)}return n}},Ci=function(k){var q=k._data,P=km(k);if(P){q.s("flow.reverse")&&(P.reverse(),P.forEach(function(l){l.reverse()}));for(var Z=0,d=[],i=P.length,z=0;i>z;z++){var n=P[z],e=Tm(n);Z+=e,d.push(e)}if(q[U]=d,q[T]=Z,q[W]=P,q instanceof o){var j=g.unionPoint(P),u=j.x+j.width/2,s=j.y+j.height/2;q.$10e={x:u,y:s}}wi(k,!0)}},wi=(g.getPercentPositionOnPoints=function(Q,V,H){if(Q){var o=km(z,Q,V);if(o){var w;if(0===H)w=o[0][0];else if(100===H)o=o[o.length-1],w=o[o.length-1];else{for(var L=0,p=[],n=o.length,g=0;n>g;g++){var B=o[g],y=Tm(B);L+=y,p.push(y)}for(var m=L*H/100,f=bq(m,p),l=0,k=0;f>k;k++)l+=p[k];m-=l,w=gl(o[f],m)}return w}}},_.getPercentPosition=function(_,H){var h=this,k=h.getDataUI(_),O=km(k);if(O){var e;if(0===H)e=O[0][0];else if(100===H)O=O[O.length-1],e=O[O.length-1];else{for(var p=0,d=[],q=O.length,l=0;q>l;l++){var J=O[l],b=Tm(J);p+=b,d.push(b)}for(var A=p*H/100,z=bq(A,d),I=0,S=0;z>S;S++)I+=d[S];A-=I,e=gl(O[z],A)}return e}},function(p,I){var j=p._data,L=j[T],o=j.s(n),S=j.s(M),R=0,H=j[U],l=j.s(Z),t=j.s(s),q=j.s(V),J=(l-t)/(q-1),i=[];if(H){if(1===q)i.push(l);else if(2===q)i.push(l),i.push(t);else{if(!(q>2))return;i.push(l);for(var k=q-2;k>0;k--)i.push(t+J*k);i.push(t)}var h=0,A=0;i.forEach(function(L){q-1>h&&(A+=j.getFlowElementSpace(L)),h++}),A+=(l+t)/2,R=(L-o*A+A)/o;var W=p[w];for(null==W&&(W=0),I||(W+=S);W>L+A;){var r=p._overCount;r?r++:r=1,r>=o&&(r=null),p._overCount=r,j.s("flow.autoreverse")?r?W-=R+A:(W=0,j.s("flow.reverse",!j.s("flow.reverse"))):W-=R+A}p[w]=W}}),He=function(F){var w=F.data,O=this.dm();if(w&&"add"===F.kind){var g=O.$3e;g&&w.s(p)&&g.indexOf(w)<0&&g.push(w)}"clear"===F.kind&&(O.$3e=[])},Pg=function(S){var R=S.property,P=S.data,Y=S.newValue,F=this.dm().$3e;if(F&&"s:flow"===R)if(Y)F.indexOf(P)<0&&F.push(P);else for(var u=F.length,y=0;u>y;y++)if(F[y]===P){F.splice(y,1);break}},bq=bq=function(u,g){for(var $=0,h=g.length,q=0;h>q;q++){var d=g[q];if($+=d,$>u)return q}return Math.min(q,h-1)},Gm=function(O){var m=this,k=m._data,J=k[T],d=k[U],C=k[W],q=k.s(n),p=0,h=m[w],F=k.s(Z),y=k.s(s),B=k.s(V),x=k.s(E),a=k.s(l),f=k.s(N),Q=(a-x)/(B-1),D=(F-y)/(B-1),o=k.getRotation?k.getRotation():0,r=k.getPosition?k.p():k.$10e,c=[],i=[];if(h!=z){if(1===B)c.push(F);else if(2===B)c.push(F),c.push(y);else{if(!(B>2))return;c.push(F);for(var v=B-2;v>0;v--)c.push(y+D*v);c.push(y)}if(1===B)i.push(a);else if(2===B)i.push(a),i.push(x);else{if(!(B>2))return;i.push(a);for(var v=B-2;v>0;v--)i.push(x+Q*v);i.push(x)}var P=0,L=0;c.forEach(function(y){B-1>P&&(L+=k.getFlowElementSpace(y)),P++}),L+=(F+y)/2,p=(J-q*L+L)/q,O.save();for(var v=0;q>v;v++){var j=h,u=0,e=m._overCount,M=0;k.s("flow.autoreverse")&&e&&e>q-(v+1)||(j-=v*(p+L),P=0,c.forEach(function(z){var q=j-u;if(q>=0&&J>q){var y=!0,H=bq(q,d);M=0;for(var I=0;H>I;I++)M+=d[I];if(q-=M,y){var g=gl(C[H],q),K=o;if(f){for(var Q=C[H],R=0,n=0,Z=0;Z<Q.length-1;Z++){var h=Q[Z],b=Q[Z+1],S=b.x-h.x,$=b.y-h.y,W=X(S*S+$*$);if(R+=W,R>q){n=Z;break}}var l=Q[n];K+=Y(g.y-l.y,g.x-l.x)}o&&(g=Fk(r,g.x-r.x,g.y-r.y,o)),m.$5e(O,g,z,i[P],K)}}u+=k.getFlowElementSpace(c[P]),P++}))}O.restore()}},yf=function(){var X=this,s=X._data,K=s.s(Z),T=!1,M=z;if(X._6I||(T=!0),M=s instanceof o?a.call(X):P.call(X),s.s(p)&&T){var E=s.s(l),V=s.s(r);V&&E>K&&(K=E),K>0&&g.grow(M,F(K/2)),Ci(X)}return!s.s(p)&&T&&Vb(s,X),M};Q.getFlowElementSpace=function(){return this.s(x)},S._79o=yf,$._79o=yf,C[Z]==z&&(C[Z]=7),C[s]==z&&(C[s]=0),C[n]==z&&(C[n]=1),C[M]==z&&(C[M]=3),C[V]==z&&(C[V]=10),C[x]==z&&(C[x]=3.5),C[N]==z&&(C[N]=!1),C[v]==z&&(C[v]="rgba(255, 255, 114, 0.4)"),C[u]==z&&(C[u]="rgba(255, 255, 0, 0.3)"),C[k]==z&&(C[k]="rgba(255, 255, 0, 0)"),C[r]==z&&(C[r]=1),C[l]==z&&(C[l]=22),C[E]==z&&(C[E]=4),A.prepareRemove=function(Y){d.call(this,Y);var T=Y._dataModel,O=T.$3e;if(O)for(var V=O.length,X=0;V>X;X++)if(O[X]===Y){O.splice(X,1);break}},_.setDataModel=function(X){var u=this,B=u._dataModel;if(B!==X){B&&(B.umm(He,u),B.umd(Pg,u),B.$3e=[]),X.mm(He,u),X.md(Pg,u);var y=X.$3e=[];X.each(function(i){i.s(p)&&y.indexOf(i)<0&&y.push(i)}),nl.call(u,X)}},_.setFlowInterval=function(q){var r=this,k=r.$11e;r.$11e=q,r.fp("flowInterval",k,q),r.$7e!=z&&(clearInterval(r.$7e),delete r.$7e,r.enableFlow(q))},_.getFlowInterval=function(){return this.$11e},_.$9e=function(){var C,B,_,y=this,N=y.tx(),q=y.ty(),I=y.getZoom(),v=y.getWidth(),S=y.getHeight(),O={x:-N/I,y:-q/I,width:v/I,height:S/I},r=y.dm().$3e,s=y._56I,j=new b;if(r.forEach(function(Y){s[Y.getId()]&&(C=y.getDataUI(Y),C&&(_=C._79o(),_&&j.add(_)))}),0!==j.size()&&(j.each(function($){g.intersectsRect(O,$)&&(B=g.unionRect(B,$))}),B&&(B&&(g.grow(B,e(1,1/I)),B.x=i(B.x*I)/I,B.y=i(B.y*I)/I,B.width=F(B.width*I)/I,B.height=F(B.height*I)/I,B=g.intersection(O,B)),B))){var o=y._canvas.getContext("2d");o.save(),o.lineCap=g.lineCap,o.lineJoin=g.lineJoin,c.translateAndScale(o,N,q,I),o.beginPath(),o.rect(B.x,B.y,B.width,B.height),o.clip(),o.clearRect(B.x,B.y,B.width,B.height),y.$6e(o,B),o.restore()}},_.$6e=function(e,j){var i,H,x=this;x._93db(e),x.each(function(O){x._56I[O._id]&&(i=x.getDataUI(O),i&&(H=i._79o(),(!j||g.intersectsRect(j,H))&&i._42(e)))}),x._92db(e)},_.enableFlow=function(x){var n=this,c=n.dm(),r=c.$3e;n.$7e==z&&(r.forEach(function(D){var R=n.getDataUI(D);Ci(R)}),n.$7e=setInterval(function(){c.$3e.forEach(function(W){wi(n.getDataUI(W))}),n.$9e()},x||n.$11e||50))},_.disableFlow=function(){var g=this;clearInterval(g.$7e),delete g.$7e;var S=g.dm().$3e;S&&g.$9e()},h.$5e=function(P,d,U,y,$){var n=this,l=n._data,Z=n.gv,f=l.s(v),s=l.s(u),e=l.s(k),Y=l.s(r),O=Z.$8e,K=l.s(I);if(O==z&&(O=Z.$8e={}),P.beginPath(),K!=z){var E=g.getImage(K),w=U/2;P.translate(d.x,d.y),P.rotate($),P.translate(-d.x,-d.y),g.drawImage(P,E,d.x-w,d.y-w,U,U,l),P.translate(d.x,d.y),P.rotate(-$),P.translate(-d.x,-d.y)}else P.fillStyle=f,P.arc(d.x,d.y,U/2,0,L,!0),P.fill();if(Y){var o=22,T=o+"_"+s+"_"+e,b=O[T];if(b==z){var a=Nj("canvas");c.setCanvas(a,o,o);var X=a.getContext("2d"),G=o/2,p=G,V=G;c.translateAndScale(X,0,0,1),X.beginPath();var W=X.createRadialGradient(p,V,0,p,p,G);W.addColorStop(0,s),W.addColorStop(1,e),X.fillStyle=W,X.arc(p,V,G,0,L,!0),X.fill(),b=O[T]=a}var w=y/2;g.drawImage(P,b,d.x-w,d.y-w,y,y,l)}},$._80o=function(Y){O.call(this,Y);var $=this,n=$._data,B=$.gv;n.s(p)&&B.$7e!=z&&Gm.call($,Y)},S._80o=function(n){m.call(this,n);var U=this,q=U._data,j=U.gv;q.s(p)&&j.$7e!=z&&Gm.call(U,n)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);